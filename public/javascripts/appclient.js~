var socket = io.connect();
var myapp = (function(){

	var test = function() {
		socket.emit('test_database', {});
	};

	socket.on('test database result', function() {
		jQuery('#people').empty();
		jQuery('#people').load('/test');

	});

    var changeUser = function() {
        var temp = $(this).text();
        console.log("changing user to: "+temp);
        socket.emit('Change User', {email:temp});
    };

    socket.on('Change User Success', function() {
        console.log("want to change page to wishlist");
        window.location.href = "/wishlist";
    });

    var selectRemoveUser = function() {
        var element = $(this);
        if(element.hasClass("selected")) {
            element.removeClass("selected");
        }else {
            element.addClass("selected");
        }
    }

    var removeUsers = function() {
        console.log("inside remove users");
        var users = [];
        $("#remove-table tr.selected td.email").each(function() {
            users.push($(this).text());
        });
       
        $.post("/remove-user", {users:users}, function(data) {
            alert(data);
            window.location = "/remove-user";
            return;
        });
    }

    
    return {
        init: function() {
            //console.log("Client-side app starting up")
			jQuery("#testbutton").click(test);
            jQuery("#Select-User a").click(changeUser);
            jQuery("#remove-table tr").click(selectRemoveUser);
            jQuery("button#remove-user").click(removeUsers);
            jQuery("#newuser-form").validate({
                rules: {
                    email1: {
                        minlength: 2,
                        required: true
                    },
                    email2: {
                        minlength: 4,
                        required: true
                    },
                    name: {
                        minlength: 1,
                        required: true
                    },
                    age: {
                        minlength: 1,
                        maxlength: 2,
                        required: true,
                        number: true
                    }
                },
                errorPlacement: function(error, element) {
                    element.parent().after(error);
                },
                highlight: function(element) {
                    $("#newuser-form button").attr("type", "");
                    $(element).removeClass('success').addClass('error');
                },
                success: function(label) {
                    $(label).remove();
                    if($("input").hasClass("error") == false) {
                        $("#newuser-form button").attr("type", "submit");
                    }
                }
            });
        }
    }
})();
jQuery(myapp.init);

